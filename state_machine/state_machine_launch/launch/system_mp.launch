<?xml version="1.0" encoding="UTF-8"?>
<launch>
    <arg name="mapper_config" default="$(find map_plan_launch)/config/mapper.yaml"/>
    <arg name="planner_config" default="$(find control_launch)/config/tracker_params_mp.yaml"/>
    <arg name="onboard_sensing" default="false"/>
    <!-- Use RGBD instead of LDIAR -->
    <arg name="use_rgbd" default="false"/>
    <arg name="robot" default="quadrotor"/>
	<arg name="lidar_frame" default=""/>

    <arg name="depth_cam" default="DepthCamera"/>
    <arg name="use_motion_primitive" default="true"/>
    <arg name="use_lauras" default="false"/>
    <arg name="takeoff_height" default="5"/>
	  <arg name="mass" default="1.74"/>
	  <arg name="lidar_cloud_topic" default="lidar"/>
    <arg name="gains_file" default="$(find control_launch)/config/so3_control_gains.yaml"/>

    <!-- S-MSCKF VIO -->
	<group if="$(arg onboard_sensing)">
		<include file="$(find estimation_launch)/launch/estimation.launch">
			<arg name="publish_body_camera_tf" value="true"/>
			<arg name="vio_imu_frame_id" value="$(arg robot)/stereo_rig_imu"/>			
		</include>
	</group>

    <!-- Controller -->
    	<group if="$(arg use_motion_primitive)">
	    <include file="$(find control_launch)/launch/control_mp.launch">
		     <arg name="mass" value="$(arg mass)"/>
		     <arg name="gains_file" value="$(arg gains_file)"/>
	    </include>
	</group>
    	
    	<group unless="$(arg use_motion_primitive)">
	    <include file="$(find control_launch)/launch/control.launch">
		     <arg name="mass" value="$(arg mass)"/>
	    </include>
	</group>


    <!-- Use RGBD -->
	<group if="$(arg use_rgbd)">
     	<!-- RGBD Covert Depth Image to Point Cloud -->
      <group ns="$(arg robot)/$(arg depth_cam)">
       <include file="$(find map_plan_launch)/launch/depth_to_cloud.launch">
       </include>
      </group>
     	<!-- Mapper and Planner -->
		<include file="$(find map_plan_launch)/launch/map_plan.launch">
      <arg name="cloud" value="$(arg depth_cam)/points"/>
		     <arg name="mapper_config" value="$(arg mapper_config)"/>
                     <arg name="planner_config" value="$(arg planner_config)" />
		     <arg name="use_mp" value="$(arg use_motion_primitive)"/>
		     <arg name="robot" value="$(arg robot)"/>
			 <arg name="lidar_frame" value="$(arg lidar_frame)"/>
		</include>
	</group>


     <!-- Use LIDAR -->
	<group unless="$(arg use_rgbd)">
     	<!-- Mapper and Planner -->
		<include file="$(find map_plan_launch)/launch/map_plan.launch">
		     <arg name="cloud" value="$(arg lidar_cloud_topic)"/>
		     <arg name="mapper_config" value="$(arg mapper_config)"/>
                     <arg name="planner_config" value="$(arg planner_config)" />
		     <arg name="use_mp" value="$(arg use_motion_primitive)"/>
		     <arg name="use_lauras" value="$(arg use_lauras)"/>
		     <arg name="robot" value="$(arg robot)"/>
		</include>
	</group>


	 <!-- State machine -->
    <include file="$(find state_machine_launch)/launch/state_machine_mp.launch">
        <arg name="takeoff_height" value="$(arg takeoff_height)"/>
    </include>
</launch>
